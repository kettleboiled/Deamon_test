name: Deploy via Public API

# –ó–∞–ø—É—Å–∫ –ø–æ –º–µ—Ç–∫–µ (–∫–∞–∫ –º—ã –∏ –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞–ª–∏—Å—å)
on:
  pull_request_target:
    types: [labeled]

jobs:
  deploy-via-api:
    # –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç–æ–∏—Ç –º–µ—Ç–∫–∞ 'deploy'
    if: contains(github.event.pull_request.labels.*.name, 'deploy')
    runs-on: ubuntu-latest

    steps:
      # 1. –°–∫–∞—á–∏–≤–∞–µ–º –∫–æ–¥ –∏–∑ PR
      - uses: actions/checkout@v3
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install requests pydantic pyyaml

      # 2. –ü–†–û–°–¢–û –û–¢–ü–†–ê–í–õ–Ø–ï–ú –§–ê–ô–õ
      # –ù–∏–∫–∞–∫–∏—Ö SSH, –Ω–∏–∫–∞–∫–∏—Ö –∫–ª—é—á–µ–π. –ü—Ä–æ—Å—Ç–æ —Å—Ç—É—á–∏–º—Å—è –ø–æ URL –∏–∑ —Å–µ–∫—Ä–µ—Ç–∞.
      - name: Upload Course
        env:
          # –°—Å—ã–ª–∫–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤ (–∫—É–¥–∞ –≤—ã –≤—Å—Ç–∞–≤–∏–ª–∏ ngrok url)
          LMS_API_URL: ${{ secrets.LMS_API_URL }}
          LMS_API_TOKEN: ${{ secrets.LMS_API_TOKEN }}
        run: |
          echo "üöÄ Sending to Public API: $LMS_API_URL"
          python runner.py *.zip